import React, {Component} from 'react'
import axios from 'axios'
import {Link} from 'react-router-dom'
import Header from './Header2'

export default class ListBlogs extends Component{

  constructor(){
    super()

    this.state = {
      blogs:[]
    }
  }

  componentDidMount(){
    axios.get('http://ec2-3-17-139-40.us-east-2.compute.amazonaws.com:6700/blog/getBlogs')
      .then((res)=>{
        this.setState({
          blogs: res.data
        })
        console.log(this.state.blogs)
      })
      .catch(err=>{
        console.log(err)
      })
  }

  deleteBlog(id){
   let confirmDelete = window.confirm("Are you sure to delete the blog of the user?")
   if(confirmDelete === true){
	axios.delete('http://ec2-3-17-139-40.us-east-2.compute.amazonaws.com:6700/blog/deleteBlog/'+id)
	   .then((res)=>{
		alert('Blog has been deleted')
		window.location.reload()
		})
	}
   axios.delete('http://ec2-3-17-139-40.us-east-2.compute.amazonaws.com:6700/blog/deleteBlog/'+id)
}


  render(){
    return(

      <div>
      <Header/>
      <div className="container">
        <h3>List of all the blogs</h3>

        <table border="1">
        <thead>
          <tr>
            <th>Blog Name</th>
            <th>By</th>
            <th>Category</th>
            <th>Created On</th>
          </tr>
        </thead>
          {this.state.blogs.map((blog, index)=>{
            return(
              <tbody key={index}>
                <tr>
                  <td><Link to={`/blog/${blog.blog_id}`}>{blog.blog_name}</Link></td>
                  <td>{blog.by}</td>
                  <td>{blog.category}</td>
                  <td>{blog.created_at}</td>
		  <td><button onClick={(e)=>{e.preventDefault(); this.deleteBlog(blog.blog_id)}}>Delete this blog</button></td>
                </tr>
              </tbody>
            )
          })}
        </table>

      </div>
      </div>
    )
  }
}
